<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">
          Ereignis schließen
        </h3>
      </div>
      <div class="panel-body">
        <!-- event not closable -->
        <div class="container-fluid" *ngIf="!isClosable">
          <h4>Das Ereignis kann nicht geschlossen werden.</h4>

          <div class="row" *ngIf="event.active && !hasTransfers">
            <div class="col-sm-12">
              <span class="fa-stack fa-lg text-danger">
                <i class="fa fa-square fa-stack-2x"></i>
                <i class="fa fa-times fa-stack-1x fa-inverse"></i>
              </span>
              <span class="checkbox-label">
                Es wurden keine Lagerbewegungen verbucht.
              </span>
            </div>
          </div>

          <div class="row" *ngIf="!event.active">
            <div class="col-sm-12">
              <span class="fa-stack fa-lg text-danger">
                <i class="fa fa-square fa-stack-2x"></i>
                <i class="fa fa-times fa-stack-1x fa-inverse"></i>
              </span>
              <span class="checkbox-label">
                Das Ereignis wurde bereits geschlossen.
              </span>
            </div>
          </div>

          <div class="row" style="margin-top: 20px">
            <div class="col-md-12">
              <button type="button" class="btn btn-danger btn-lg btn-block" (click)="cancelForm()">
                <il-icon for="cancel"></il-icon>
                Abbrechen
              </button>
            </div>
          </div>
        </div>

        <!-- event closable -->
        <form [formGroup]="form" (ngSubmit)="submitForm()" *ngIf="isClosable">
          <div class="container-fluid">

            <div class="row" *ngIf="!event.eventType.countAllowed">
              <div class="col-sm-12">
                <span class="fa-stack fa-lg text-success">
                  <i class="fa fa-square fa-stack-2x"></i>
                  <i class="fa fa-check fa-stack-1x fa-inverse"></i>
                </span>
                <span class="checkbox-label">
                  Ich habe alle Lagerbewegungen verbucht.
                </span>
              </div>
            </div>

            <ng-template [ngIf]="event.eventType.countAllowed">
              <div class="row">
                <div class="col-sm-12">
                  <span class="fa-stack fa-lg text-success">
                    <i class="fa fa-square fa-stack-2x"></i>
                    <i class="fa fa-check fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="checkbox-label">
                    <ng-template [ngIf]="event.countedStorage" [ngIfElse]="tplNotCountedStorage">Das Lager wurde gezählt.</ng-template>
                    <ng-template #tplNotCountedStorage>Das Lager wurde nicht gezählt. Alle Lagerbewegungen wurden einzeln verbucht.</ng-template>
                  </span>
                </div>
              </div>

              <div class="row" *ngIf="event.countedCounter">
                <div class="col-sm-12">
                  <span class="fa-stack fa-lg text-success">
                    <i class="fa fa-square fa-stack-2x"></i>
                    <i class="fa fa-check fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="checkbox-label">
                    Die Kühlschränke wurden gezählt.
                  </span>
                </div>
              </div>
            </ng-template>

            <div style="margin-top: 20px"></div>

            <div class="row" *ngIf="event.eventType.countAllowed && !event.countedCounter">
              <div class="col-sm-12">
                <div class="alert" [ngClass]="{ 'alert-warning': !form.value.ignoreCounterCount, 'alert-success': form.value.ignoreCounterCount }">
                  Die Kühlschränke wurden nicht gezählt. Bei Veranstaltungen im Club ist am Ende <strong>immer eine Kühlschrankzählung notwendig</strong>.
                  Bist Du sicher, dass Du fortfahren möchtest?

                  <div class="row" style="margin-top: 10px">
                    <div class="col-sm-12">
                      <il-checkbox-control formControlName="ignoreCounterCount">Ja, ohne Kühlschrankzählung schließen.</il-checkbox-control>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <div class="row" *ngIf="event.eventType.realEvent && cashEmpty && !isPrivateRemoval">
              <div class="col-sm-12">
                <div class="alert" [ngClass]="{ 'alert-warning': !form.value.ignoreNoCash, 'alert-success': form.value.ignoreNoCash }">
                  Du hast noch keinen Kassenstand eingetragen.
                  Ist das korrekt so?

                  <div class="row" style="margin-top: 10px">
                    <div class="col-sm-12">
                      <il-checkbox-control formControlName="ignoreNoCash">Nicht notwendig / mache ich später</il-checkbox-control>
                      <p><strong>Bitte trage den Kassenstand auch ins Barbuch ein.</strong></p>
                    </div>
                  </div>

                </div>
              </div>
            </div>


            <div class="form-group form-group-lg" *ngIf="isPrivateRemoval">
              <hr>
              <h4>Wie viel Geld hast Du bezahlt?</h4>
              <div class="input-group input-group-lg">
                <input type="number" class="form-control" step="0.01" formControlName="cashAfter">
                <span class="input-group-addon">EUR</span>
              </div>
              <span class="help-block">
                Mindestbetrag für Deine Entnahme:
                <strong *ngIf="costs; else costsLoading">{{ costs | currency:'EUR':true }}</strong>
                <ng-template #costsLoading>
                  <il-icon for="spinner"></il-icon>
                  Wird geladen…
                </ng-template>
              </span>
            </div>



            <div class="row">
              <hr>
              <div class="col-sm-12">
                <il-checkbox-control formControlName="confirmClose">Alle Angaben sind richtig und ich möchte das Ereignis schließen.</il-checkbox-control>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12">

                <div class="form-group" style="margin-top: 30px">
                  <div class="col-md-6">
                    <button type="button" class="btn btn-danger btn-lg btn-block" (click)="cancelForm()">
                      <il-icon for="cancel"></il-icon>
                      Abbrechen
                    </button>
                  </div>
                  <div class="col-md-6">
                    <button type="submit"
                      class="btn btn-success btn-lg btn-block"
                      [disabled]="counterCountInvalid || cashInvalid || privateNoCash || !form.value.confirmClose">
                      <il-icon for="ok" *ngIf="!loading"></il-icon>
                      <il-icon for="spinner" *ngIf="loading"></il-icon>
                      Schließen
                    </button>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
